---
title: "Introduction to mfcurve"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{mfcurve-intro}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r}
# Load necessary libraries
library(mfcurve)
library(ggplot2)
```

# Overview
# mfcurve is an R package designed for multi-factor analysis, allowing users to preprocess data, perform statistical tests, and create visualizations similar to what can be done using the Stata mfcurve ado file. This vignette will guide you through the key functionalities of the package.

# Installation
To install mfcurve, you can use the following command to install from GitHub:

```{r}
# Install devtools if not already installed
# install.packages("devtools")

# Install mfcurve from GitHub
# devtools::install_github("cweileder/mfcurve")
```

# Key Functions
# The mfcurve package provides three main functions:
# - mfcurve_preprocessing(): Preprocesses data by filtering missing values, handling factors, and creating groups.
# - mfcurve_stat_test(): Conducts statistical tests (e.g., t-tests) on group means to flag significant differences.
# - mfcurve_plot(): Generates visualizations showing group differences with confidence intervals.

# Example Workflow

# 1. Preprocessing Data
# The first step is to preprocess your data, filtering missing values and creating the necessary groups.

# Sample data
data <- data.frame(
  wage = c(10, 20, 30, 40, 15, 25, 35, 45),
  race = factor(c("black", "black", "white", "white", "black", "white", "black", "white")),
  union = factor(c(1, 0, 1, 0, 1, 0, 1, 0))
)

# Preprocess the data
preprocessed_data <- mfcurve_preprocessing(data, "wage", c("race", "union"))

# View the preprocessed data
print(preprocessed_data)

# 2. Conducting Statistical Tests
# After preprocessing, you can perform statistical tests to identify significant differences between groups.

# Conduct statistical tests
test_results <- mfcurve_stat_test(preprocessed_data, level = 0.05, test = "mean")

# View the test results
print(test_results)

# 3. Plotting the Results
# Finally, visualize the results using the mfcurve_plot function to replicate the types of plots generated by Stata mfcurve.

# Plot the results
mfcurve_plot(test_results)

# Example Plot
# Hereâ€™s an example of what the plot might look like:

ggplot(test_results, aes(x = reorder(group, mean_outcome), y = mean_outcome)) +
  geom_point(aes(color = significant), size = 3) +
  geom_errorbar(aes(ymin = ci_lower, ymax = ci_upper), width = 0.2) +
  scale_color_manual(values = c("TRUE" = "red", "FALSE" = "black")) +
  labs(
    title = "Group Differences in Mean Outcome",
    x = "Group",
    y = "Mean Outcome"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Conclusion
# This vignette demonstrates the basic workflow of mfcurve, from preprocessing your data to visualizing group differences.
# The package provides a streamlined way to conduct multi-factor analysis in R, offering similar functionalities 
# to the Stata mfcurve ado file but with the flexibility and power of R's data manipulation and visualization capabilities.

# References
# Include any relevant references or acknowledgments here.
